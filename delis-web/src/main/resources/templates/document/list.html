<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout (~{::body})}"
>
<body>
<div class="card border-primary">
    <div class="card-header bg-primary text-white">
        Documents
    </div>
    <div class="card-body">
        <form method="POST" enctype="multipart/form-data" action="/document/list/filter"
              th:action="@{/document/list/filter}">
            <table class="table form-group">
                <tr>
                    <th>Received</th>
                    <th>Organisation</th>
                    <th>Status</th>
                    <th>Format</th>
                </tr>
                <tr>
                    <td>
                        <select class="form-control"  th:onchange="|javascript:setTableFormDateFilter('documentTableForm', 'createTime', this.value, 'All')|">
                            <option>All</option>
                            <option th:selected="${'Today'.equals(filterFields.get('createTime_date_range_description'))}">Today</option>
                            <option th:selected="${'Last week'.equals(filterFields.get('createTime_date_range_description'))}">Last week</option>
                            <option th:selected="${'Last month'.equals(filterFields.get('createTime_date_range_description'))}">Last month</option>
                        </select>
                    </td>
                    <td>
                        <select class="form-control" th:onchange="|javascript:setTableFormFilter('documentTableForm', 'organisation', this.value, 'All')|">
                            <option>All</option>
                            <option th:replace="~{fragments/sorting :: filter_field_option_list (fieldName='organisation',
                                    fieldValues=${availableOrganisationNames},
                                    selectedValue=${filterFields.get('organisation')})}">All</option>
                        </select>
                    </td>
                    <td>
                        <select class="form-control" th:onchange="|javascript:setTableFormFilter('documentTableForm', 'documentStatus', this.value, 'All')|">
                            <option>All</option>
                            <option th:replace="~{fragments/sorting :: filter_field_option_list (fieldName='documentStatus',
                                    fieldValues=${T(dk.erst.delis.data.enums.document.DocumentStatus).values()},
                                    selectedValue=${filterFields.get('documentStatus')})}">LOAD_OK</option>
                        </select>
                    </td>
                    <td>
                        <select class="form-control" th:onchange="|javascript:setTableFormFilter('documentTableForm', 'ingoingDocumentFormat', this.value, 'All')|">
                            <option>All</option>
                            <option th:replace="~{fragments/sorting :: filter_field_option_list (fieldName='ingoingDocumentFormat',
                                    fieldValues=${T(dk.erst.delis.data.enums.document.DocumentFormat).values()},
                                    selectedValue=${filterFields.get('ingoingDocumentFormat')})}">CII</option>
                        </select>
                    </td>
                </tr>
            </table>
        </form>
        <form action="#" th:action="@{/document/updatestatuses}" th:object="${selectedIdList}" method="post">
            <table class="table table-striped table-bordered table-sm">
                <tr>
                    <th>
                        <input type="checkbox" class="selectAll checkbox" name="selectAll" id="selectAll"/>
                    </th>
                    <th th:replace="~{fragments/sorting :: tableheader (${documentList},
                        ${new String[]{'Received', 'Organisation', 'Receiver', 'Status', 'Ingoing Type', 'Ingoing Format', 'Sender'}},
                        ${new String[]{'createTime','organisation.name','receiverIdentifier.name','documentStatus','documentType','ingoingDocumentFormat','senderName'}})}"/>
                </tr>
                <tr th:each="r,iter : ${documentList.items}">
                    <td><input type="checkbox" th:field="*{idList}" th:value="${r.id}" class="selectItem checkbox"
                               name="selectItem" id="selectItem"/></td>
                    <td>
                        <a href="#" th:href="@{/document/view/__${r.id}__}"
                           th:text="${#dates.format(r.createTime, 'yyyy-MM-dd HH:mm:ss')}">2018-10-12 10:43:22</a>
                    </td>
                    <td>
                        <a th:if="${r.organisation}" href="#"
                           th:href="@{/document/view/__${r.id}__}"
                           th:text="${r.organisation.name}">Region Nord</a>
                    </td>
                    <td>
                        <a th:if="${r.receiverIdentifier}" href="#"
                           th:href="@{/document/view/__${r.id}__}"
                           th:text="${r.receiverIdentifier.name}">Receiver name</a>
                        <span th:text="${r.receiverIdRaw}">0088:234234234</span>
                    </td>
                    <td th:text="${r.documentStatus}">LOAD_OK</td>
                    <td th:text="${r.documentType}">Invoice</td>
                    <td th:text="${r.ingoingDocumentFormat}">BIS3_INVOICE</td>
                    <td th:text="${r.senderName}">Lego Spain</td>
                </tr>
            </table>
            <div class="card-footer">
                <div class="d-flex justify-content-start">
                    <label class="m-2 col-form-label">Status:</label>
                    <select th:field="*{status}" class="m-2">
                        <option th:each="documentStatus : ${statusList}" th:text="${documentStatus}"
                                th:value="${documentStatus}"></option>
                    </select>
                    <button type="submit" class="m-2 btn btn-primary">Update Statuses</button>
                </div>
            </div>
        </form>
    </div>
    <div class="card-footer"
         th:include="~{fragments/sorting :: paginator (${documentList.paginatorStart},${documentList.paginatorEnd},${documentList.totalPages},${documentList.currentPage})}">
    </div>

    <div th:replace="~{fragments/sorting :: tableform (
            formNameForJS = 'documentTableForm',
            formAction = @{/document/list/filter},
            sortField = ${documentList.sortField},
            sortDirection = ${documentList.sortDirection},
            currentPage = ${documentList.currentPage},
            filterFields = ${filterFields} )}">
    </div>

    <div class="card">
        <div class="card-header bg-primary text-white">
            Upload document
        </div>
        <div class="card-body">
            <form method="POST" enctype="multipart/form-data" action="/document/upload" th:action="@{/document/upload}">
                <div class="form-group">
                    <label for="file1">File:</label>
                    <input type="file" name="file" class="form-control-file" id="file1"/>
                </div>
                <div class="form-check mb-2">
                    <input type="checkbox" name="validateImmediately" class="form-check-input"
                           id="validateImmediately"/>
                    <label for="validateImmediately" class="form-check-label">Validate immediately</label>
                </div>
                <input class="btn btn-primary" type="submit" value="Upload"/>
            </form>
        </div>
    </div>
</div>
</body>
</html>